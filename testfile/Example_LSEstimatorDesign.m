% Least-squares estimator design
clc;
clear all
close all

P=[1.1 3.3 2.2 5.5 4.4]';  % coefficients of the plant
%%
% H=[0.537667139546100,	-1.34988694015652,	0.671497133608081,	0.888395631757642,	-0.102242446085491;
%    1.83388501459509,	3.03492346633185,	-1.20748692268504,	-1.14707010696915,	-0.241447041607358;
%   -2.25884686100365,	0.725404224946106,	0.717238651328839,	-1.06887045816803,	0.319206739165502;
%    0.862173320368121,	-0.0630548731896562,	1.63023528916473,	-0.809498694424876,	0.312858596637428;
%    0.318765239858981,	0.714742903826096,	0.488893770311789,	-2.94428416199490,	-0.864879917324457;
%   -1.30768829630527,	-0.204966058299775,	1.03469300991786,	1.43838029281510,	-0.0300512961962686;
%   -0.433592022305684,	-0.124144348216312,	0.726885133383238,	0.325190539456198,	-0.164879019209038;
%    0.342624466538650,	1.48969760778547,	-0.303440924786016,	-0.754928319169703,	0.627707287528727;
%    3.57839693972576,	1.40903448980048,	0.293871467096658,	1.37029854009523,	1.09326566903948;
%    2.76943702988488,	1.41719241342961,	-0.787282803758638,	-1.71151641885370,	1.10927329761440];
% Z = [2.03110213467170,
% 	-1.43688536557928,
% 	-2.54988763758495,
% 	2.83956690548387,
% 	-12.8934532042587,
% 	8.52235361541256,
% 	1.20547582943732,
% 	2.90189888147641,
% 	18.0000184239238,
% 	3.05963039693985]; 
% N=20;
% H=randn(N,5);
% % H=H/norm(H,inf);
% Z=H*P+2*randn(N,1);
% save Example_LSEstimator.mat H Z;
%%
load Example_LSEstimator.mat;
%%

% LS
P_ls = inv(H'*H)*H'*Z
v = Z-H*P_ls;
v = v-mean(v);
Vv = v*v'/(length(v)-1);
Vv=diag(diag(Vv));
Var_ls =  inv(H'*H)*H'*Vv*H*inv(H'*H)

% Weighted LS
v = Z-H*P_ls;
W=diag(1./(1+v.*v));
P_wls = inv(H'*W*H)*H'*W*Z
Var_wls = inv(H'*W*H)*H'*W*Vv*W*H*inv(H'*W*H)

% Maximum-Likelihood

W=inv(Vv);
P_ml = inv(H'*W*H)*H'*W*Z
Var_ml = inv(H'*inv(Vv)*H)

% LMV

P_lmv = P_ls + Var_ls*H'*inv(H*Var_ls*H'+Vv)*(Z-H*P_ls)
Var_lmv = inv(inv(Var_ls)+H'*inv(Vv)*H)



